version: 1
frontend:
  phases:
    preBuild:
      commands:
        # Node.jsãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’20ã«è¨­å®š
        - nvm use 20
        - node -v
        - npm -v
        - npm ci
    build:
      commands:
        # amplify_outputs.jsonã‚’æ¢ã—ã¦é…ç½®
        - |
          echo "ğŸ” Searching for amplify_outputs.json..."
          find . -name "amplify_outputs.json" -type f 2>/dev/null | head -10
          if [ -f "../.amplify-hosting/static/amplify_outputs.json" ]; then
            echo "âœ… Found in .amplify-hosting/static"
            cp "../.amplify-hosting/static/amplify_outputs.json" ./public/
          elif [ -f "amplify_outputs.json" ]; then
            echo "âœ… Found in current directory"
            cp amplify_outputs.json ./public/
          fi
          ls -la ./public/amplify_outputs.json || echo "âš ï¸ amplify_outputs.json not found in public"
        - npm run build
        # ãƒ“ãƒ«ãƒ‰å¾Œã«ã‚‚ã†ä¸€åº¦ç¢ºèª
        - |
          if [ -f "./public/amplify_outputs.json" ]; then
            cp ./public/amplify_outputs.json ./dist/
            echo "âœ… Copied amplify_outputs.json to dist"
          fi
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*